<!DOCTYPE html>
<html lang="it">

<head th:replace="fragments/header :: header('Aggiungi Ricetta')">
	<style>
		.image-container img {
			width: 100%;
			object-fit: cover;
			max-height: 280px;
			min-height: 280px;
		}
	</style>
</head>

<body style="background: #e6e2dc; background-image: url('/images/sfondo.jpeg'); background-size: cover; background-repeat: no-repeat; background-attachment: fixed;">
	<div th:replace="fragments/navbar :: navbar"></div>
	<div class="container mt-5 mb-5 form-container" style="max-width: 900px; margin: 0 auto; padding: 20px;">
		<h2 class="text-center mb-4">Aggiungi Ricetta</h2>
		<form th:action="@{/cuoco/aggiungiRicetta}" method="post" enctype="multipart/form-data">
			<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
			<input type="hidden" id="cuocoId" name="cuocoId" th:value="${cuocoCorrente.id}" />

			<div class="row">
				<!-- Colonna Inserimento Dati -->
				<div class="col-md-4" style="flex: 0 0 33.3333%; max-width: 33.3333%;">
					<div class="mb-3">
						<label for="nome" class="form-label">Nome:</label>
						<input type="text" class="form-control" id="nome" name="nome" placeholder="Nome della ricetta" required>
					</div>
					<div class="mb-3">
						<label for="descrizione" class="form-label">Descrizione:</label>
						<textarea class="form-control" id="descrizione" name="descrizione" rows="4" placeholder="Descrizione della ricetta"></textarea>
					</div>
					<div class="mb-3">
						<label for="fileImages" class="form-label">Carica immagine della ricetta:</label>
						<input type="file" class="form-control" id="fileImages" name="fileImages" accept="image/*" multiple required>
					</div>
				</div>

				<!-- Colonna Ingredienti -->
				<div class="col-md-8" style="flex: 0 0 66.6667%; max-width: 66.6667%;">
					<div id="ingredienti-section">
						<template id="ingredient-template">
							<div class="row align-items-center mb-2 ingredienti-group">
								<div class="col-md-6 p-1">
									<select class="form-control" name="ingredientiIds" required>
										<option th:each="ing : ${ingredienti}" th:value="${ing.id}" th:text="${ing.nome}">Ingrediente</option>
									</select>
								</div>
								<div class="col-md-4 p-2">
									<input type="text" class="form-control" name="quantita" placeholder="QuantitÃ ">
								</div>
								<div class="col-md-1 p-0">
									<button type="button" class="btn btn-danger remove-ingrediente">
										<img src="/images/frecciaIndietro.svg" alt="Remove" style="filter: invert(1);">
									</button>
								</div>
							</div>
						</template>
					</div>

					<div class="d-flex justify-content-center">
						<button type="button" class="btn btn-primary mb-3" id="add-ingrediente">Aggiungi Ingrediente</button>
					</div>
					<div class="d-flex justify-content-center">
						<p class="mb-3" style="color: black;">Se mancano degli ingredienti, torna indietro e aggiungili prima di continuare.</p>
					</div>
				</div>
			</div>

			<div class="d-flex justify-content-center">
				<button type="submit" class="btn btn-success mt-1">Salva Ricetta</button>
			</div>
		</form>
	</div>

	<div th:replace="fragments/footer :: footer"></div>

	<!-- Script per la gestione degli ingredienti -->
	<script>
		document.getElementById('add-ingrediente').addEventListener('click', function () {
			const template = document.getElementById('ingredient-template').content.cloneNode(true);
			document.getElementById('ingredienti-section').appendChild(template);
		});

		document.addEventListener('click', function (e) {
			if (e.target && e.target.classList.contains('remove-ingrediente')) {
				e.target.closest('.ingredienti-group').remove();
			}
		});
	</script>
</body>

</html>
